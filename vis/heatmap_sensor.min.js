function cartesianProduct(t){return t.reduce(function(t,e){return t.map(function(t){return e.map(function(e){return t.concat(e)})}).reduce(function(t,e){return t.concat(e)},[])},[[]]).map(function(t){return t[0]+"_"+t[1]})}function start(){var t=[{month:"Abril",data:"../data/sensor_4_avg.tsv"},{month:"Agosto",data:"../data/sensor_8_avg.tsv"},{month:"Diciembre",data:"../data/sensor_12_avg.tsv"}];d3.select("#datasets").append("select").attr("class","select").on("change",function(){var t=d3.select(".select").property("value");drawHeatMap(t)}).selectAll("option").data(t).enter().append("option").text(function(t){return t.month}).attr("value",function(t){return t.data})}const margin={top:20,right:100,bottom:30,left:5},width=1400-margin.left-margin.right,height=1100-margin.top-margin.bottom,reds=["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],buckets=reds.length,chemicals=["Methylosmolene","Chlorodinine","AGOC-3A","Appluimonia"],hours=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],yValues=cartesianProduct([hours,chemicals]),gridSize=30,legendElementWidth=2*gridSize;const svg=d3.select("#chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),yLabels=svg.selectAll(".yLabels").data(yValues).enter().append("text").text(function(t){return t}).attr("x",950).attr("y",(t,e)=>e*(gridSize/3)).style("text-anchor","left").attr("transform","translate(-6,"+gridSize/3/1.5+")").attr("class","yLabels mono"),xLabels=svg.selectAll(".xLabels").data(days).enter().append("text").text(function(t){return t}).attr("x",(t,e)=>e*gridSize).attr("y",0).style("text-anchor","end").attr("transform","translate("+gridSize/2+", -6)").attr("class","xLabels mono"),type=t=>{var e=d3.select(".select").property("selectedIndex"),a=d3.select(".select").property("options")[e].text;return{y:t.Chemical,x:t.Day,value:t.Reading,hour:t.Hour,label:a+" "+t.Day+" - Reading: "+t.Reading+" ("+t.Chemical+")"}},drawHeatMap=function(t){d3.tsv(t,type,(t,e)=>{if(t)console.log(t);else{const t=d3.scaleQuantile().domain([0,buckets-1,d3.max(e,t=>t.value)]).range(reds),a=svg.selectAll(".reading").data(e,t=>t.x+":"+t.hour+"_"+t.y);a.append("title"),a.enter().append("rect").attr("x",t=>(t.x-1)*gridSize).attr("y",t=>{var e=t.hour+"_"+t.y;return yValues.indexOf(e)*(gridSize/3)}).attr("rx",4).attr("ry",4).attr("class","reading bordered").attr("width",gridSize).attr("height",gridSize/3).style("fill",reds[0]).merge(a).transition().duration(1e3).style("fill",e=>t(e.value)),a.select("title").text(t=>t.label),a.exit().remove();const r=svg.selectAll(".legend").data([0].concat(t.quantiles()),t=>t),n=r.enter().append("g").attr("class","legend");n.append("rect").attr("x",(t,e)=>legendElementWidth*e).attr("y",980).attr("width",legendElementWidth).attr("height",gridSize/2).style("fill",(t,e)=>reds[e]),n.append("text").attr("class","mono").text(t=>"â‰¥ "+t.toFixed(2)).attr("x",(t,e)=>legendElementWidth*e).attr("y",1010),r.exit().remove()}})};start(),drawHeatMap("../data/sensor_4_avg.tsv");